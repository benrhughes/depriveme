<html>
  <head>
  	<title>DepriveMe - Absence makes the heart grow fonder</title>
  	<script type="text/javascript" src="./underscore-min.js"></script>
    <script src="https://apis.google.com/js/client.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script type="text/javascript">
		var clientId = '839550991886';

		var apiKey = 'AIzaSyD6jfPPmLp0zruUdCy2HA4XopM_HO7j4kU';

		// To enter one or more authentication scopes, refer to the documentation for the API.
		var scopes = 'https://www.googleapis.com/auth/calendar';

		// Use a button to handle authentication the first time.
		function handleClientLoad() {
			gapi.client.setApiKey(apiKey);
			window.setTimeout(checkAuth,1);
		}

		function checkAuth() {
			gapi.auth.authorize({client_id: clientId, scope: scopes, immediate: true}, handleAuthResult);
		}


		function handleAuthResult(authResult) {
			if (authResult) {
				$('#auth').hide();
			  	makeApiCall();

			} else {
			  $('#auth').show();
			}
		}

		function handleAuthClick(event) {
			event.preventDefault();
			gapi.auth.authorize({client_id: clientId, scope: scopes, immediate: false}, handleAuthResult);
		}

		// Load the API and make an API call.  Display the results on the screen.
		function makeApiCall() {
			gapi.client.load('calendar', 'v3', function() {
			  	var request = gapi.client.calendar.calendarList.list();
			  	request.execute(function(data) {
		    		if (!data)
					//error

					var depriveCal = _.find(data.items, function(item){ return item.summary == 'DepriveMe'; });

					if(!depriveCal)
						alert("There's no DepriveMe calendar, lets create it");

		  		});
			});
		}

		handleClientLoad();
    </script>

  </head>

  <body>
  	<div id="title">
  		<h2>DepriveMe</h2>
  	</div>
  	<div id="welcome">
  		<p>DepriveMe</p>
    	<button onclick="handleAuthClick();" id="auth">Authorize Google Calendar Access</button>
    </div>
    <div id="huh">
    	For a while I've been experimenting with taking a 24hr break from the things in my life that I enjoy or 
		depend on. I've found that it is a great way to increase the appreciation of what I have. Plus it help me 
		become less attached to material things.
    	<br />
		DepriveMe is a simple tool I wrote to help me keep this organised. Randomising it makes it a bit more fun, too. 
		It works like this:
		<ul>
			<li>If it doesn't already exist, a 'DepriveMe' calendar is created in your Google Calandar</li>
			<li>You enter a list of things you'd like to take a scheduled break from. My list includes: coffee; food;
				hot showers; my smartphone and music</li>
			<li>You specify how long a period you want the list spread across</li>
			<li>DepriveMe randomly, but somewhat evenly distributes new events each item across the time period</li>
		</ul>

    </div>
  </body>
</html>
