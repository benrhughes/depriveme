<html>
  <head>
  	<title>Deprive Me - Absence makes the heart grow fonder</title>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
  	<script type="text/javascript" src="./underscore-min.js"></script>
    <script type="text/javascript">
		var clientId = '839550991886';
		var apiKey = 'AIzaSyD6jfPPmLp0zruUdCy2HA4XopM_HO7j4kU';
		var scopes = 'https://www.googleapis.com/auth/calendar';

		// function checkAuth() {
		// 	gapi.auth.authorize({client_id: clientId, scope: scopes, immediate: true}, handleAuthResult);
		// }

		function handleClientLoad(){
			gapi.client.setApiKey(apiKey);
		}

		function handleAuthResult(authResult) {
			if (authResult) {
				$('#auth').disable();
			  	makeApiCall();

			} else {
				alert('Something went wrong, please try again');
			}
			  	$('#auth').enable();
		}

		function handleAuthClick(event) {
			event.preventDefault();
			gapi.auth.authorize({client_id: clientId, scope: scopes, immediate: false}, handleAuthResult);
		}

		function makeApiCall() {
			gapi.client.load('calendar', 'v3', function() {
			  	var request = gapi.client.calendar.calendarList.list();
			  	request.execute(function(data) {
		    		if (!data)
					//error

					var depriveCal = _.find(data.items, function(item){ return item.summary == 'DepriveMe'; });

					if(!depriveCal)
						alert("There's no DepriveMe calendar, lets create it");

		  		});
			});
		}

		function addRow(val){
			var rowHtml = '<tr> \
  					<td><input type="text" class="item" value="' + (val || "") + '" /></td> \
  					<td> \
  						<input type="checkbox" checked="true" class="sun">S</input> \
  						<input type="checkbox" checked="true" class="mon">M</input> \
  						<input type="checkbox" checked="true" class="tue">T</input> \
  						<input type="checkbox" checked="true" class="wed">W</input> \
  						<input type="checkbox" checked="true" class="thu">T</input> \
  						<input type="checkbox" checked="true" class="fri">F</input> \
  						<input type="checkbox" checked="true" class="sat">S</input> \
  					</td> \
  				</tr>';

			$('#items tbody:last').append(rowHtml);

		}

		$(document).ready(function(){
			$('#huh').hide();

			addRow('internet, food, music...');

			$('#showHuh').click(function(e){
				e.preventDefault();
				$('#huh').show();
			});


			$('#hideHuh').click(function(e){
				e.preventDefault();
				$('#huh').hide();
			});
		});
    </script>
    <script src="https://apis.google.com/js/client.js?onload=handleClientLoad"></script>

  </head>

  <body>
  	<div id="title">
  		<h2>Deprive Me</h2>
  		<h4>Absence makes the heart grow fonder</h4>
  		<a href="#" id="showHuh">Huh?</a>
  	</div>
  	<div id="data">
  		Over next next <input type="text" id="numberOfDats"/> days, randomly deprive me of:
  		<br/>
  		<table id="items">
  			<thead>
  				<th></th>
  				<th></th>
  			</thead>
  			<tbody>
  			</tbody>
  		</table>
  		<button onclick="addRow()">+</button>
    	<button onclick="handleAuthClick();" id="auth">Add Events</button>
    </div>
    <div id="huh">
    	For a while I've been experimenting with taking a 24hr break from the things in my life that I enjoy or 
		depend on. I've found that it is a great way to increase my appreciation of what I have. Plus it help me 
		become less attached to material things.
    	<br /><br />
		DepriveMe is a simple tool I wrote to help me keep this organised. Randomising it makes it a bit more fun, too. 
		It works like this:
		<ul>
			<li>If it doesn't already exist, a 'DepriveMe' calendar is created in your Google Calandar</li>
			<li>You enter a list of things you'd like to take a scheduled break from. My list includes: coffee; food;
				hot showers; my smartphone and music</li>
			<li>You specify how long a period you want the list spread across</li>
			<li>DepriveMe randomly, but somewhat evenly distributes new events each item across the time period</li>
		</ul>
		<a href="#" id="hideHuh">Hide</a>
    </div>
  </body>
</html>
